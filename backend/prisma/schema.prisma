// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Usuario {
  id            Int      @id @default(autoincrement())
  nombre        String
  username      String   @unique
  passwordHash  String   @map("password_hash")
  rol           String   // "dueño" o "trabajador"
  negocioId     Int?     @map("negocio_id") // NULL para dueños, obligatorio para trabajadores
  activo        Boolean  @default(true)
  creadoEn      DateTime @default(now()) @map("creado_en")
  
  // Relaciones
  negocio          Negocio? @relation(fields: [negocioId], references: [id])
  historialEstados HistorialEstado[]
  
  @@map("usuarios")
}

model Negocio {
  id       Int      @id @default(autoincrement())
  nombre   String   @unique
  
  // Relaciones
  trabajos   Trabajo[]
  trabajadores Usuario[]
  
  @@map("negocios")
}

model Cliente {
  id        Int      @id @default(autoincrement())
  nombre    String
  telefono  String?
  notaExtra String?  @map("nota_extra")
  creadoEn  DateTime @default(now()) @map("creado_en")
  
  // Relaciones
  trabajos  Trabajo[]
  
  @@map("clientes")
}

model Trabajo {
  id                Int       @id @default(autoincrement())
  negocioId         Int       @map("negocio_id")
  clienteId         Int       @map("cliente_id")
  descripcion       String
  precioEstimado    Float?    @map("precio_estimado")
  estadoActual      String    @map("estado_actual") // "pendiente", "en_proceso", "completado", "cancelado"
  fechaCreacion     DateTime  @default(now()) @map("fecha_creacion")
  fechaFinalizacion DateTime? @map("fecha_finalizacion")
  
  // Relaciones
  negocio          Negocio           @relation(fields: [negocioId], references: [id])
  cliente          Cliente           @relation(fields: [clienteId], references: [id])
  historialEstados HistorialEstado[]
  
  @@map("trabajos")
}

model HistorialEstado {
  id        Int      @id @default(autoincrement())
  trabajoId Int      @map("trabajo_id")
  estado    String
  nota      String?  // Nota o comentario del trabajador
  fechaHora DateTime @default(now()) @map("fecha_hora")
  usuarioId Int      @map("usuario_id")
  
  // Relaciones
  trabajo Trabajo @relation(fields: [trabajoId], references: [id])
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  
  @@map("historial_estados")
}
